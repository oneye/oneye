(function(a){function c(a,b){var c,d=b.ownerDocument,e=d.createRange();return e.setStartBefore(b),e.setEnd(a.endContainer,a.endOffset),c=d.createElement("body"),c.appendChild(e.cloneContents()),c.innerHTML.replace(/<(br|img|object|embed|input|textarea)[^>]*>/gi,"-").replace(/<[^>]+>/g,"").length==0}function d(a,b){return parseInt(a.getAttribute(b)||1)}function e(c,e,f){function l(a,b){return a=a.cloneNode(b),a.removeAttribute("id"),a}function m(){var a=0;g=[],b(["thead","tbody","tfoot"],function(f){var h=e.select("> "+f+" tr",c);b(h,function(c,h){h+=a,b(e.select("> td, > th",c),function(a,b){var c,e,i,j;if(g[h])while(g[h][b])b++;i=d(a,"rowspan"),j=d(a,"colspan");for(e=h;e<h+i;e++){g[e]||(g[e]=[]);for(c=b;c<b+j;c++)g[e][c]={part:f,real:e==h&&c==b,elm:a,rowspan:i,colspan:j}}})}),a+=h.length})}function n(a,b){var c=g[b];if(c)return c[a]}function o(a,b,c){a&&(c=parseInt(c),c===1?a.removeAttribute(b,1):a.setAttribute(b,c,1))}function p(a){return a&&(e.hasClass(a.elm,"mceSelected")||a==k)}function q(){var a=[];return b(c.rows,function(c){b(c.cells,function(b){if(e.hasClass(b,"mceSelected")||b==k.elm)return a.push(c),!1})}),a}function r(){var a=e.createRng();a.setStartAfter(c),a.setEndAfter(c),f.setRng(a),e.remove(c)}function s(c){var d;return a.walk(c,function(f){var g;if(f.nodeType==3)return b(e.getParents(f.parentNode,null,c).reverse(),function(a){a=l(a,!1),d?g&&g.appendChild(a):d=g=a,g=a}),g&&(g.innerHTML=a.isIE?"&nbsp;":'<br data-mce-bogus="1" />'),!1},"childNodes"),c=l(c,!1),o(c,"rowSpan",1),o(c,"colSpan",1),d?c.appendChild(d):a.isIE||(c.innerHTML='<br data-mce-bogus="1" />'),c}function t(){var a=e.createRng();b(e.select("tr",c),function(a){a.cells.length==0&&e.remove(a)});if(e.select("tr",c).length==0){a.setStartAfter(c),a.setEndAfter(c),f.setRng(a),e.remove(c);return}b(e.select("thead,tbody,tfoot",c),function(a){a.rows.length==0&&e.remove(a)}),m(),row=g[Math.min(g.length-1,h.y)],row&&(f.select(row[Math.min(row.length-1,h.x)].elm,!0),f.collapse(!0))}function u(a,b,c,d){var f,h,i,j,k=g[b][a].elm.parentNode;for(h=1;h<=c;h++){k=e.getNext(k,"tr");if(k){for(f=a;f>=0;f--){j=g[b+h][f].elm;if(j.parentNode==k){for(i=1;i<=d;i++)e.insertAfter(s(j),j);break}}if(f==-1)for(i=1;i<=d;i++)k.insertBefore(s(k.cells[0]),k.cells[0])}}}function v(){b(g,function(a,c){b(a,function(a,b){var f,g,h;if(p(a)){a=a.elm,f=d(a,"colspan"),g=d(a,"rowspan");if(f>1||g>1){o(a,"rowSpan",1),o(a,"colSpan",1);for(h=0;h<f-1;h++)e.insertAfter(s(a),a);u(b,c,g-1,f)}}})})}function w(c,d,f){var c,i,k,l,p,q,r,s,u,w,x;c?(pos=G(c),i=pos.x,k=pos.y,l=i+(d-1),p=k+(f-1)):(i=h.x,k=h.y,l=j.x,p=j.y),s=n(i,k),u=n(l,p);if(s&&u&&s.part==u.part){v(),m(),s=n(i,k).elm,o(s,"colSpan",l-i+1),o(s,"rowSpan",p-k+1);for(r=k;r<=p;r++)for(q=i;q<=l;q++){if(!g[r]||!g[r][q])continue;c=g[r][q].elm,c!=s&&(w=a.grep(c.childNodes),b(w,function(a){s.appendChild(a)}),w.length&&(w=a.grep(s.childNodes),x=0,b(w,function(a){a.nodeName=="BR"&&e.getAttrib(a,"data-mce-bogus")&&x++<w.length-1&&s.removeChild(a)})),e.remove(c))}t()}}function z(a){var c,f,h,i,j,k,m,n,q;b(g,function(d,e){b(d,function(b){if(p(b)){b=b.elm,j=b.parentNode,k=l(j,!1),c=e;if(a)return!1}});if(a)return!c});for(i=0;i<g[0].length;i++){if(!g[c][i])continue;f=g[c][i].elm;if(f!=h){if(!a){q=d(f,"rowspan");if(q>1){o(f,"rowSpan",q+1);continue}}else if(c>0&&g[c-1][i]){n=g[c-1][i].elm,q=d(n,"rowSpan");if(q>1){o(n,"rowSpan",q+1);continue}}m=s(f),o(m,"colSpan",f.colSpan),k.appendChild(m),h=f}}k.hasChildNodes()&&(a?j.parentNode.insertBefore(k,j):e.insertAfter(k,j))}function A(a){var c,f;b(g,function(d){b(d,function(b,d){if(p(b)){c=d;if(a)return!1}});if(a)return!c}),b(g,function(b,g){var h,i,j;if(!b[c])return;h=b[c].elm,h!=f&&(j=d(h,"colspan"),i=d(h,"rowspan"),j==1?a?(h.parentNode.insertBefore(s(h),h),u(c,g,i-1,j)):(e.insertAfter(s(h),h),u(c,g,i-1,j)):o(h,"colSpan",h.colSpan+1),f=h)})}function B(){var c=[];b(g,function(f){b(f,function(f,h){p(f)&&a.inArray(c,h)===-1&&(b(g,function(a){var b=a[h].elm,c=d(b,"colSpan");c>1?o(b,"colSpan",c-1):e.remove(b)}),c.push(h))})}),t()}function C(){function c(a){var c,f,h=e.getNext(a,"tr");b(a.cells,function(a){var b=d(a,"rowSpan");b>1&&(o(a,"rowSpan",b-1),c=G(a),u(c.x,c.y,1,1))}),c=G(a.cells[0]),b(g[c.y],function(a){var b;a=a.elm,a!=f&&(b=d(a,"rowSpan"),b>1?o(a,"rowSpan",b-1):e.remove(a),f=a)})}var a;a=q(),b(a.reverse(),function(a){c(a)}),t()}function D(){var a=q();return e.remove(a),t(),a}function E(){var a=q();return b(a,function(b,c){a[c]=l(b,!0)}),a}function F(a,c){var d=q(),f=d[c?0:d.length-1],h=f.cells.length;b(g,function(a){var c;h=0,b(a,function(a){a.real&&(h+=a.colspan),a.elm.parentNode==f&&(c=1)});if(c)return!1}),c||a.reverse(),b(a,function(a){var b,d=a.cells.length;for(i=0;i<d;i++)b=a.cells[i],o(b,"colSpan",1),o(b,"rowSpan",1);for(i=d;i<h;i++)a.appendChild(s(a.cells[d-1]));for(i=h;i<d;i++)e.remove(a.cells[i]);c?f.parentNode.insertBefore(a,f):e.insertAfter(a,f)})}function G(a){var c;return b(g,function(d,e){return b(d,function(b,d){if(b.elm==a)return c={x:d,y:e},!1}),!c}),c}function H(a){h=G(a)}function I(){var a,c=a=0;return b(g,function(d,e){b(d,function(b,d){var f,h;p(b)&&(b=g[e][d],d>c&&(c=d),e>a&&(a=e),b.real&&(f=b.colspan-1,h=b.rowspan-1,f&&d+f>c&&(c=d+f),h&&e+h>a&&(a=e+h)))})}),{x:c,y:a}}function J(a){var b,c,d,f,i,k,l,m;j=G(a);if(h&&j){b=Math.min(h.x,j.x),c=Math.min(h.y,j.y),d=Math.max(h.x,j.x),f=Math.max(h.y,j.y),i=d,k=f;for(y=c;y<=k;y++)a=g[y][b],a.real||b-(a.colspan-1)<b&&(b-=a.colspan-1);for(x=b;x<=i;x++)a=g[c][x],a.real||c-(a.rowspan-1)<c&&(c-=a.rowspan-1);for(y=c;y<=f;y++)for(x=b;x<=d;x++)a=g[y][x],a.real&&(l=a.colspan-1,m=a.rowspan-1,l&&x+l>i&&(i=x+l),m&&y+m>k&&(k=y+m));e.removeClass(e.select("td.mceSelected,th.mceSelected"),"mceSelected");for(y=c;y<=k;y++)for(x=b;x<=i;x++)g[y][x]&&e.addClass(g[y][x].elm,"mceSelected")}}var g,h,j,k;m(),k=e.getParent(f.getStart(),"th,td"),k&&(h=G(k),j=I(),k=n(h.x,h.y)),a.extend(this,{deleteTable:r,split:v,merge:w,insertRow:z,insertCol:A,deleteCols:B,deleteRows:C,cutRows:D,copyRows:E,pasteRows:F,getPos:G,setStartCell:H,setEndCell:J})}var b=a.each;a.create("tinymce.plugins.TablePlugin",{init:function(f,g){function k(a){var b=f.selection,c=f.dom.getParent(a||b.getNode(),"table");if(c)return new e(c,f.dom,b)}function l(){f.getBody().style.webkitUserSelect="",j&&(f.dom.removeClass(f.dom.select("td.mceSelected,th.mceSelected"),"mceSelected"),j=!1)}var h,i,j=!0;b([["table","table.desc","mceInsertTable",!0],["delete_table","table.del","mceTableDelete"],["delete_col","table.delete_col_desc","mceTableDeleteCol"],["delete_row","table.delete_row_desc","mceTableDeleteRow"],["col_after","table.col_after_desc","mceTableInsertColAfter"],["col_before","table.col_before_desc","mceTableInsertColBefore"],["row_after","table.row_after_desc","mceTableInsertRowAfter"],["row_before","table.row_before_desc","mceTableInsertRowBefore"],["row_props","table.row_desc","mceTableRowProps",!0],["cell_props","table.cell_desc","mceTableCellProps",!0],["split_cells","table.split_cells_desc","mceTableSplitCells",!0],["merge_cells","table.merge_cells_desc","mceTableMergeCells",!0]],function(a){f.addButton(a[0],{title:a[1],cmd:a[2],ui:a[3]})}),a.isIE||f.onClick.add(function(a,b){b=b.target,b.nodeName==="TABLE"&&(a.selection.select(b),a.nodeChanged())}),f.onPreProcess.add(function(a,b){var c,d,e=a.dom,f=e.select("table",b.node),g=f.length;while(g--){c=f[g],e.setAttrib(c,"data-mce-style","");if(d=e.getAttrib(c,"width"))e.setStyle(c,"width",d),e.setAttrib(c,"width","");if(d=e.getAttrib(c,"height"))e.setStyle(c,"height",d),e.setAttrib(c,"height","")}}),f.onNodeChange.add(function(a,b,c){var d;c=a.selection.getStart(),d=a.dom.getParent(c,"td,th,caption"),b.setActive("table",c.nodeName==="TABLE"||!!d),d&&d.nodeName==="CAPTION"&&(d=0),b.setDisabled("delete_table",!d),b.setDisabled("delete_col",!d),b.setDisabled("delete_table",!d),b.setDisabled("delete_row",!d),b.setDisabled("col_after",!d),b.setDisabled("col_before",!d),b.setDisabled("row_after",!d),b.setDisabled("row_before",!d),b.setDisabled("row_props",!d),b.setDisabled("cell_props",!d),b.setDisabled("split_cells",!d),b.setDisabled("merge_cells",!d)}),f.onInit.add(function(e){function o(a,b,c,d){var e,f,g,h=3,i=a.dom.getParent(b.startContainer,"TABLE");return i&&(e=i.parentNode),f=b.startContainer.nodeType==h&&b.startOffset==0&&b.endOffset==0&&d&&(c.nodeName=="TR"||c==e),g=(c.nodeName=="TD"||c.nodeName=="TH")&&!d,f||g}function p(b){var c,d,e,f;if(!a.isWebKit)return;c=b.selection.getRng(),d=b.selection.getNode(),e=b.dom.getParent(c.startContainer,"TD,TH");if(!o(b,c,d,e))return;e||(e=d),f=e.lastChild;while(f.lastChild)f=f.lastChild;c.setEnd(f,f.nodeValue.length),b.selection.setRng(c)}var f,g,m,n=e.dom;h=e.windowManager,e.onMouseDown.add(function(a,b){b.button!=2&&(l(),g=n.getParent(b.target,"td,th"),f=n.getParent(g,"table"))}),n.bind(e.getDoc(),"mouseover",function(a){var b,c,d=a.target;if(g&&(m||d!=g)&&(d.nodeName=="TD"||d.nodeName=="TH")){c=n.getParent(d,"table"),c==f&&(m||(m=k(c),m.setStartCell(g),e.getBody().style.webkitUserSelect="none"),m.setEndCell(d),j=!0),b=e.selection.getSel();try{b.removeAllRanges?b.removeAllRanges():b.empty()}catch(h){}a.preventDefault()}}),e.onMouseUp.add(function(b){var c,d,e,h,i,j,k=b.selection,l=k.getSel();if(g){m&&(b.getBody().style.webkitUserSelect="");function o(b,d){var e=new a.dom.TreeWalker(b,b);do{if(b.nodeType==3&&a.trim(b.nodeValue).length!=0){d?c.setStart(b,0):c.setEnd(b,b.nodeValue.length);return}if(b.nodeName=="BR"){d?c.setStartBefore(b):c.setEndBefore(b);return}}while(b=d?e.next():e.prev())}d=n.select("td.mceSelected,th.mceSelected");if(d.length>0){c=n.createRng(),h=d[0],j=d[d.length-1],c.setStartBefore(h),c.setEndAfter(h),o(h,1),e=new a.dom.TreeWalker(h,n.getParent(d[0],"table"));do if(h.nodeName=="TD"||h.nodeName=="TH"){if(!n.hasClass(h,"mceSelected"))break;i=h}while(h=e.next());o(i),k.setRng(c)}b.nodeChanged(),g=m=f=null}}),e.onKeyUp.add(function(){l()}),e.onKeyDown.add(function(a){p(a)}),e.onMouseDown.add(function(a,b){b.button!=2&&p(a)}),e.plugins.table.fixTableCellSelection=p,e&&e.plugins.contextmenu&&e.plugins.contextmenu.onContextMenu.add(function(a,b,c){var d,f=e.selection,g=f.getNode()||e.getBody();e.dom.getParent(c,"td")||e.dom.getParent(c,"th")||e.dom.select("td.mceSelected,th.mceSelected").length?(b.removeAll(),g.nodeName=="A"&&!e.dom.getAttrib(g,"name")&&(b.add({title:"advanced.link_desc",icon:"link",cmd:e.plugins.advlink?"mceAdvLink":"mceLink",ui:!0}),b.add({title:"advanced.unlink_desc",icon:"unlink",cmd:"UnLink"}),b.addSeparator()),g.nodeName=="IMG"&&g.className.indexOf("mceItem")==-1&&(b.add({title:"advanced.image_desc",icon:"image",cmd:e.plugins.advimage?"mceAdvImage":"mceImage",ui:!0}),b.addSeparator()),b.add({title:"table.desc",icon:"table",cmd:"mceInsertTable",value:{action:"insert"}}),b.add({title:"table.props_desc",icon:"table_props",cmd:"mceInsertTable"}),b.add({title:"table.del",icon:"delete_table",cmd:"mceTableDelete"}),b.addSeparator(),d=b.addMenu({title:"table.cell"}),d.add({title:"table.cell_desc",icon:"cell_props",cmd:"mceTableCellProps"}),d.add({title:"table.split_cells_desc",icon:"split_cells",cmd:"mceTableSplitCells"}),d.add({title:"table.merge_cells_desc",icon:"merge_cells",cmd:"mceTableMergeCells"}),d=b.addMenu({title:"table.row"}),d.add({title:"table.row_desc",icon:"row_props",cmd:"mceTableRowProps"}),d.add({title:"table.row_before_desc",icon:"row_before",cmd:"mceTableInsertRowBefore"}),d.add({title:"table.row_after_desc",icon:"row_after",cmd:"mceTableInsertRowAfter"}),d.add({title:"table.delete_row_desc",icon:"delete_row",cmd:"mceTableDeleteRow"}),d.addSeparator(),d.add({title:"table.cut_row_desc",icon:"cut",cmd:"mceTableCutRow"}),d.add({title:"table.copy_row_desc",icon:"copy",cmd:"mceTableCopyRow"}),d.add({title:"table.paste_row_before_desc",icon:"paste",cmd:"mceTablePasteRowBefore"}).setDisabled(!i),d.add({title:"table.paste_row_after_desc",icon:"paste",cmd:"mceTablePasteRowAfter"}).setDisabled(!i),d=b.addMenu({title:"table.col"}),d.add({title:"table.col_before_desc",icon:"col_before",cmd:"mceTableInsertColBefore"}),d.add({title:"table.col_after_desc",icon:"col_after",cmd:"mceTableInsertColAfter"}),d.add({title:"table.delete_col_desc",icon:"delete_col",cmd:"mceTableDeleteCol"})):b.add({title:"table.desc",icon:"table",cmd:"mceInsertTable"})});if(a.isWebKit){function q(c,e){function i(b,d,e){var f,g,h,i,k=b?"previousSibling":"nextSibling",n=c.dom.getParent(d,"tr"),o=n[k];if(o)return t(c,d,o,b),a.dom.Event.cancel(e),!0;f=c.dom.getParent(n,"table"),g=n.parentNode,h=g.nodeName.toLowerCase();if(h==="tbody"||h===(b?"tfoot":"thead")){i=j(b,f,g,"tbody");if(i!==null)return l(b,i,d,e)}return m(b,n,k,f,e)}function j(a,b,d,e){var f,g=c.dom.select(">"+e,b),h=g.indexOf(d);return a&&h===0||!a&&h===g.length-1?k(a,b):h===-1?(f=d.tagName.toLowerCase()==="thead"?0:g.length-1,g[f]):g[h+(a?-1:1)]}function k(a,b){var d=a?"thead":"tfoot",e=c.dom.select(">"+d,b);return e.length!==0?e[0]:null}function l(b,d,e,f){var g=n(d,b);return g&&t(c,e,g,b),a.dom.Event.cancel(f),!0}function m(b,d,e,f,g){var h,j,k=f[e];return k?(o(k),!0):(h=c.dom.getParent(f,"td,th"),h?i(b,h,g):(j=n(d,!b),o(j),a.dom.Event.cancel(g)))}function n(a,b){return a&&a[b?"lastChild":"firstChild"]}function o(a){c.selection.setCursorLocation(a,0)}function p(){return h==g.UP||h==g.DOWN}function q(a){var b=a.selection.getNode(),c=a.dom.getParent(b,"tr");return c!==null}function r(a){var b=0,c=a;while(c.previousSibling)c=c.previousSibling,b+=d(c,"colspan");return b}function s(a,c){var e=0,f=0;return b(a.children,function(a,b){e+=d(a,"colspan"),f=b;if(e>c)return!1}),f}function t(a,b,c,d){var e=r(a.dom.getParent(b,"td,th")),f=s(c,e),g=c.childNodes[f],h=n(g,d);o(h||g)}function u(a){var b=c.selection.getNode(),d=c.dom.getParent(b,"td,th"),e=c.dom.getParent(a,"td,th");return d&&d!==e&&v(d,e)}function v(a,b){return c.dom.getParent(a,"TABLE")===c.dom.getParent(b,"TABLE")}var f,g=a.VK,h=e.keyCode;p()&&q(c)&&(f=c.selection.getNode(),setTimeout(function(){u(f)&&i(!e.shiftKey&&h===g.UP,f,e)},0))}e.onKeyDown.add(q)}if(!a.isIE){function r(){var a;for(a=e.getBody().lastChild;a&&a.nodeType==3&&!a.nodeValue.length;a=a.previousSibling);a&&a.nodeName=="TABLE"&&e.dom.add(e.getBody(),"p",null,'<br mce_bogus="1" />')}a.isGecko&&e.onKeyDown.add(function(a,b){var d,e,f=a.dom;if(b.keyCode==37||b.keyCode==38)d=a.selection.getRng(),e=f.getParent(d.startContainer,"table"),e&&a.getBody().firstChild==e&&c(d,e)&&(d=f.createRng(),d.setStartBefore(e),d.setEndBefore(e),a.selection.setRng(d),b.preventDefault())}),e.onKeyUp.add(r),e.onSetContent.add(r),e.onVisualAid.add(r),e.onPreProcess.add(function(a,b){var c=b.node.lastChild;c&&c.childNodes.length==1&&c.firstChild.nodeName=="BR"&&a.dom.remove(c)}),a.isGecko&&e.onKeyDown.add(function(b,c){var d,e,f;c.keyCode===a.VK.ENTER&&c.shiftKey&&(d=b.selection.getRng().startContainer,e=n.getParent(d,"td,th"),e&&(f=b.getDoc().createTextNode("ï»¿"),n.insertAfter(f,d)))}),r(),e.startContent=e.getContent({format:"raw"})}}),b({mceTableSplitCells:function(a){a.split()},mceTableMergeCells:function(a){var b,c,d=f.dom.getParent(f.selection.getNode(),"th,td");d&&(b=d.rowSpan,c=d.colSpan),f.dom.select("td.mceSelected,th.mceSelected").length?a.merge():h.open({url:g+"/merge_cells.htm",width:240+parseInt(f.getLang("table.merge_cells_delta_width",0)),height:110+parseInt(f.getLang("table.merge_cells_delta_height",0)),inline:1},{rows:b,cols:c,onaction:function(b){a.merge(d,b.cols,b.rows)},plugin_url:g})},mceTableInsertRowBefore:function(a){a.insertRow(!0)},mceTableInsertRowAfter:function(a){a.insertRow()},mceTableInsertColBefore:function(a){a.insertCol(!0)},mceTableInsertColAfter:function(a){a.insertCol()},mceTableDeleteCol:function(a){a.deleteCols()},mceTableDeleteRow:function(a){a.deleteRows()},mceTableCutRow:function(a){i=a.cutRows()},mceTableCopyRow:function(a){i=a.copyRows()},mceTablePasteRowBefore:function(a){a.pasteRows(i,!0)},mceTablePasteRowAfter:function(a){a.pasteRows(i)},mceTableDelete:function(a){a.deleteTable()}},function(a,b){f.addCommand(b,function(){var b=k();b&&(a(b),f.execCommand("mceRepaint"),l())})}),b({mceInsertTable:function(a){h.open({url:g+"/table.htm",width:400+parseInt(f.getLang("table.table_delta_width",0)),height:320+parseInt(f.getLang("table.table_delta_height",0)),inline:1},{plugin_url:g,action:a?a.action:0})},mceTableRowProps:function(){h.open({url:g+"/row.htm",width:400+parseInt(f.getLang("table.rowprops_delta_width",0)),height:295+parseInt(f.getLang("table.rowprops_delta_height",0)),inline:1},{plugin_url:g})},mceTableCellProps:function(){h.open({url:g+"/cell.htm",width:400+parseInt(f.getLang("table.cellprops_delta_width",0)),height:295+parseInt(f.getLang("table.cellprops_delta_height",0)),inline:1},{plugin_url:g})}},function(a,b){f.addCommand(b,function(b,c){a(c)})})}}),a.PluginManager.add("table",a.plugins.TablePlugin)})(tinymce);